# 高级图形工具功能说明

## 概述

为 AIIgniteCAD 项目添加了一系列复杂的图形绘制工具，包括齿轮、渐开线、螺旋线、弹簧、正多边形和椭圆等。

## 新增工具

### 1. 齿轮 (Gear)
- **图标**: settings
- **功能**: 生成标准渐开线齿轮
- **参数**:
  - 齿数 (Number of Teeth): 3-200，默认 20
  - 模数 (Module): 0.5-50mm，默认 5mm
  - 压力角 (Pressure Angle): 14.5-25°，默认 20°
- **数学原理**: 基于渐开线方程生成齿形
- **使用方法**: 点击工具后，在画布上点击确定中心位置，然后在弹出的对话框中设置参数

### 2. 正多边形 (Polygon)
- **图标**: hexagon
- **功能**: 生成正多边形
- **参数**:
  - 边数 (Sides): 3-100，默认 6
  - 旋转角度 (Rotation): 0-360°，默认 0°
- **使用方法**: 点击确定中心位置后设置参数，默认外接圆半径为 100

### 3. 椭圆 (Ellipse)
- **图标**: circle
- **功能**: 生成椭圆
- **参数**:
  - X 轴半径 (Radius X): 1-1000，默认 100
  - Y 轴半径 (Radius Y): 1-1000，默认 60
  - 旋转角度 (Rotation): 0-360°，默认 0°
- **使用方法**: 点击确定中心位置后设置参数

### 4. 阿基米德螺旋线 (Spiral)
- **图标**: water_voc
- **功能**: 生成阿基米德螺旋线
- **参数**:
  - 圈数 (Turns): 1-20，默认 3
  - 起始半径 (Start Radius): 0-500，默认 20
  - 每圈半径增量 (Radius Increment): 1-200，默认 30
- **数学原理**: r = a + b·θ
- **使用方法**: 点击确定中心位置后设置参数

### 5. 弹簧 (Spring)
- **图标**: toys
- **功能**: 生成螺旋弹簧
- **参数**:
  - 圈数 (Coils): 1-50，默认 8
  - 弹簧半径 (Spring Radius): 1-200，默认 20
- **使用方法**: 点击确定起始位置后设置参数，弹簧默认水平方向延伸 200 单位

### 6. 渐开线 (Involute)
- **图标**: show_chart
- **功能**: 生成标准渐开线曲线
- **参数**:
  - 基圆半径 (Base Radius): 10-500，默认 50
  - 圈数 (Turns): 1-10，默认 2
- **数学原理**: 参数方程 x = r(cos θ + θ sin θ), y = r(sin θ - θ cos θ)
- **使用方法**: 点击确定起始位置后设置参数

## 技术实现

### 文件结构

1. **types.ts** - 扩展了工具类型和 CADElement 接口
   - 新增工具类型: GEAR, POLYGON, ELLIPSE, SPIRAL, SPRING, INVOLUTE
   - 扩展元素类型支持: ELLIPSE, GEAR, SPIRAL, SPRING
   - 添加相关属性字段

2. **services/advancedShapesService.ts** - 核心数学计算服务
   - `generateGear()` - 齿轮生成算法
   - `generatePolygon()` - 正多边形生成
   - `generateEllipse()` - 椭圆生成
   - `generateSpiral()` - 螺旋线生成
   - `generateSpring()` - 弹簧生成
   - `generateInvolute()` - 渐开线生成

3. **components/AdvancedShapeModal.tsx** - 参数输入对话框
   - 根据不同工具类型显示相应的参数输入界面
   - 参数验证和默认值设置

4. **components/Toolbar.tsx** - 工具栏更新
   - 在"Advanced Shapes"分类下添加所有新工具

5. **App.tsx** - 状态管理和事件处理
   - 添加 `showAdvancedShapeModal` 状态
   - 实现 `handleRequestAdvancedShape()` 和 `confirmAdvancedShape()` 方法

6. **components/Canvas.tsx** - 画布渲染和交互
   - 添加工具点击处理逻辑
   - 扩展元素渲染支持
   - 更新捕捉点和碰撞检测

### 渲染策略

所有高级图形最终都转换为点阵列 (points[])，使用 SVG 的 `<polyline>` 元素进行渲染：
- 齿轮：通过渐开线算法生成齿形轮廓点
- 椭圆：参数方程采样 64 个点
- 螺旋线：根据圈数动态调整采样密度
- 弹簧：3D 螺旋投影到 2D 平面

### 工作流程

1. 用户在工具栏选择高级图形工具
2. 在画布上点击确定位置
3. 弹出参数设置对话框
4. 输入参数并确认
5. 调用相应的生成函数创建图形
6. 将图形添加到画布并自动切换回选择工具

## 使用示例

### 绘制标准齿轮

```typescript
// 20齿，模数5，压力角20度的标准齿轮
generateGear(
  { x: 400, y: 300 },  // 中心点
  20,                   // 齿数
  5,                    // 模数
  20,                   // 压力角
  "#8b949e",           // 颜色
  "0"                  // 图层
)
```

### 绘制六边形

```typescript
// 边长100的正六边形
generatePolygon(
  { x: 400, y: 300 },  // 中心点
  100,                  // 外接圆半径
  6,                    // 边数
  0,                    // 旋转角度
  "#8b949e",           // 颜色
  "0"                  // 图层
)
```

## 扩展建议

### 可添加的功能

1. **齿轮副**
   - 自动生成啮合齿轮对
   - 计算中心距和传动比

2. **更多曲线类型**
   - 贝塞尔曲线
   - B样条曲线
   - 对数螺线

3. **参数化建模**
   - 保存图形模板
   - 批量生成相似图形

4. **动态预览**
   - 在参数调整时实时预览图形
   - 添加尺寸标注

5. **交互式绘制**
   - 多点定义（如弹簧的起点和终点）
   - 拖拽调整参数

## 性能考虑

- 复杂图形（如齿轮）使用较高的采样密度以确保平滑度
- 点数过多可能影响渲染性能，可考虑实现 LOD（细节层次）
- 建议对大量复杂图形使用虚拟化渲染

## 已知限制

1. 弹簧当前只支持水平方向，未来可支持任意方向的两点绘制
2. 多边形半径目前是固定值100，可改为交互式定义
3. 椭圆没有实现真正的椭圆弧编辑功能

## 测试建议

1. 测试边界值（如最小和最大齿数）
2. 验证图形的数学准确性
3. 测试选择、移动、旋转、镜像等变换操作
4. 验证 DXF 导入导出兼容性
